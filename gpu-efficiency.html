<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GPU Efficiency &amp; SM Utilization — From Matrix Multiply to TensorBoard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0a0a;
  --bg-card: #121212;
  --bg-card-hover: #1a1a1a;
  --bg-section-alt: #0f0f0f;
  --fg: #f2f2f2;
  --fg-muted: #a3a3a3;
  --border: #262626;
  --border-light: #333;
  --primary: #00d46a;
  --primary-dim: #00a854;
  --secondary: #00c8e6;
  --accent: #a78bfa;
  --red: #FF7043;
  --orange: #FF9800;
  --yellow: #FFCA28;
  --blue: #42A5F5;
  --green: #66BB6A;
  --pink: #F06292;
  --font-sans: 'Inter', system-ui, -apple-system, sans-serif;
  --font-mono: 'JetBrains Mono', 'Fira Code', monospace;
  --font-serif: 'Instrument Serif', Georgia, serif;
  --max-w: 1280px;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; font-size: 16px; }
body {
  background: var(--bg); color: var(--fg); font-family: var(--font-sans);
  line-height: 1.7; -webkit-font-smoothing: antialiased; overflow-x: hidden;
}
a { color: var(--primary); text-decoration: none; }
a:hover { text-decoration: underline; }
code, pre { font-family: var(--font-mono); }
.container { max-width: var(--max-w); margin: 0 auto; padding: 0 24px; }

.gradient-text {
  background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}

/* NAVBAR */
.navbar {
  position: fixed; top: 0; left: 0; right: 0; z-index: 100;
  background: rgba(10,10,10,0.85); backdrop-filter: blur(16px);
  -webkit-backdrop-filter: blur(16px); border-bottom: 1px solid var(--border);
}
.nav-inner {
  max-width: var(--max-w); margin: 0 auto; padding: 12px 24px;
  display: flex; align-items: center; justify-content: space-between;
}
.nav-brand { display: flex; align-items: center; gap: 8px; font-weight: 600; font-size: 1.1rem; }
.brand-tag {
  font-size: 0.7rem; background: var(--primary); color: #000;
  padding: 2px 8px; border-radius: 9999px; font-weight: 600;
  text-transform: uppercase; letter-spacing: 0.5px;
}
.nav-links { display: flex; gap: 20px; flex-wrap: wrap; }
.nav-links a { color: var(--fg-muted); font-size: 0.82rem; font-weight: 500; transition: color 0.2s; }
.nav-links a:hover { color: var(--primary); text-decoration: none; }

/* HERO */
.hero {
  position: relative; min-height: 100vh; display: flex;
  align-items: center; justify-content: center; text-align: center;
  padding: 120px 24px 80px; overflow: hidden;
}
.hero-bg-orbs { position: absolute; inset: 0; pointer-events: none; }
.orb { position: absolute; border-radius: 50%; filter: blur(120px); opacity: 0.12; }
.orb-green { width: 500px; height: 500px; background: var(--primary); top: 10%; left: 10%; animation: float-slow 20s ease-in-out infinite; }
.orb-cyan { width: 400px; height: 400px; background: var(--secondary); top: 40%; right: 5%; animation: float-slow 25s ease-in-out infinite reverse; }
.orb-purple { width: 350px; height: 350px; background: var(--accent); bottom: 10%; left: 30%; animation: float-slow 22s ease-in-out infinite; }
@keyframes float-slow {
  0%, 100% { transform: translate(0, 0); }
  25% { transform: translate(30px, -20px); }
  50% { transform: translate(-20px, 30px); }
  75% { transform: translate(20px, 20px); }
}
.hero-content { position: relative; z-index: 1; max-width: 900px; }
.hero-badge {
  display: inline-flex; align-items: center; gap: 8px;
  background: rgba(0,212,106,0.1); border: 1px solid rgba(0,212,106,0.3);
  border-radius: 9999px; padding: 6px 18px; font-size: 0.82rem;
  font-weight: 500; color: var(--primary); margin-bottom: 24px;
}
.pulse-dot { width: 8px; height: 8px; background: var(--primary); border-radius: 50%; animation: pulse 2s ease-in-out infinite; }
@keyframes pulse { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.4); } }
.hero h1 { font-family: var(--font-serif); font-style: italic; font-size: clamp(2.5rem, 7vw, 4.5rem); font-weight: 400; line-height: 1.1; margin-bottom: 20px; }
.hero-subtitle { font-size: 1.1rem; color: var(--fg-muted); line-height: 1.7; max-width: 700px; margin: 0 auto 40px; }
.hero-cards { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }
.hero-stat-card {
  background: var(--bg-card); border: 1px solid var(--border); border-radius: 12px;
  padding: 20px 12px; transition: border-color 0.3s, transform 0.2s;
}
.hero-stat-card:hover { border-color: rgba(0,212,106,0.3); transform: translateY(-2px); }
.stat-number {
  font-size: 1.8rem; font-weight: 700;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}
.stat-label { font-size: 0.78rem; color: var(--fg-muted); margin-top: 4px; }

/* SECTIONS */
.section { padding: 100px 0; position: relative; }
.section-dark { background: var(--bg-section-alt); }
.section-heading { text-align: center; margin-bottom: 60px; }
.section-label {
  display: inline-block; font-size: 0.78rem; font-weight: 600;
  text-transform: uppercase; letter-spacing: 1.5px; color: var(--primary); margin-bottom: 12px;
}
.section-heading h2 {
  font-family: var(--font-serif); font-style: italic;
  font-size: clamp(2rem, 4vw, 3rem); font-weight: 400; line-height: 1.2; margin-bottom: 16px;
}
.section-subtitle { color: var(--fg-muted); font-size: 1.05rem; max-width: 700px; margin: 0 auto; }

/* CARDS */
.card {
  background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px;
  padding: 28px 24px; transition: border-color 0.3s, transform 0.2s;
}
.card:hover { border-color: rgba(0,212,106,0.3); transform: translateY(-3px); }
.card h3 { font-size: 1.15rem; font-weight: 600; margin-bottom: 8px; }
.card p, .card li { font-size: 0.88rem; color: var(--fg-muted); line-height: 1.6; }
.card code { background: rgba(0,0,0,0.3); padding: 2px 6px; border-radius: 4px; font-size: 0.82rem; color: var(--secondary); }

/* GRIDS */
.grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
.grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
.grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; }
@media (max-width: 900px) { .grid-2, .grid-3, .grid-4, .hero-cards { grid-template-columns: 1fr; } }

/* EQUATION BOX */
.equation-box {
  background: #0d0d1a; border: 1px solid rgba(0,200,230,0.2); border-radius: 10px;
  padding: 16px 20px; margin: 16px 0; font-family: var(--font-mono);
  font-size: 0.88rem; color: var(--secondary); text-align: center;
}
.eq-label { display: block; font-size: 0.72rem; text-transform: uppercase; letter-spacing: 1px; color: var(--fg-muted); margin-bottom: 8px; font-family: var(--font-sans); }
.eq-highlight { color: var(--primary); font-weight: 600; }

/* CALLOUTS */
.callout { border-radius: 12px; padding: 20px 24px; margin: 20px 0; font-size: 0.88rem; line-height: 1.6; }
.callout-info { background: rgba(66,165,245,0.06); border: 1px solid rgba(66,165,245,0.2); color: var(--fg); }
.callout-warn { background: rgba(255,112,67,0.06); border: 1px solid rgba(255,112,67,0.2); }
.callout-success { background: rgba(0,212,106,0.06); border: 1px solid rgba(0,212,106,0.2); }

/* CODE BLOCK */
.code-block {
  background: #0d0d1a; border: 1px solid rgba(167,139,250,0.15); border-radius: 10px;
  padding: 16px 20px; margin: 16px 0; overflow-x: auto; font-size: 0.8rem; line-height: 1.6;
}
.code-block .kw { color: var(--accent); }
.code-block .fn { color: var(--secondary); }
.code-block .cm { color: #6a6a8a; }
.code-block .st { color: var(--green); }
.code-block .num { color: var(--orange); }

/* TAKEAWAYS */
.takeaway-card {
  background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px;
  padding: 28px 24px;
  border-top: 3px solid; border-image: linear-gradient(135deg, var(--primary), var(--secondary)) 1;
  border-image-slice: 1 1 0 0;
}
.takeaway-num {
  font-size: 2rem; font-weight: 700; font-family: var(--font-mono);
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
  margin-bottom: 8px;
}
.takeaway-card h4 { font-size: 1rem; font-weight: 600; margin-bottom: 8px; }
.takeaway-card p { font-size: 0.85rem; color: var(--fg-muted); line-height: 1.6; }

/* FOOTER */
.footer { padding: 60px 0 40px; border-top: 1px solid var(--border); text-align: center; }
.footer-brand { font-size: 1.1rem; font-weight: 600; margin-bottom: 8px; }
.footer p { font-size: 0.82rem; color: var(--fg-muted); }

/* SCROLL ANIMATIONS */
.fade-in { opacity: 0; transform: translateY(20px); transition: opacity 0.6s ease, transform 0.6s ease; }
.fade-in.visible { opacity: 1; transform: translateY(0); }

/* ============ MATRIX VIS ============ */
.matrix-container {
  display: flex; align-items: center; justify-content: center;
  gap: 16px; flex-wrap: wrap; margin: 20px 0;
}
.matrix-grid {
  display: grid; border: 2px solid var(--border); border-radius: 8px;
  overflow: hidden;
}
.matrix-grid.mat-a { border-color: var(--pink); }
.matrix-grid.mat-b { border-color: var(--blue); }
.matrix-grid.mat-c { border-color: var(--primary); }
.matrix-cell {
  width: 38px; height: 38px; display: flex; align-items: center; justify-content: center;
  font-size: 0.6rem; font-family: var(--font-mono); font-weight: 600;
  border: 1px solid rgba(255,255,255,0.05); transition: all 0.3s;
}
.matrix-cell.highlight-row { background: rgba(240,98,146,0.25); }
.matrix-cell.highlight-col { background: rgba(66,165,245,0.25); }
.matrix-cell.highlight-result { background: rgba(0,212,106,0.35); }
.matrix-label { font-size: 0.82rem; font-weight: 600; font-family: var(--font-mono); text-align: center; margin-bottom: 6px; }
.matrix-op { font-size: 1.6rem; color: var(--fg-muted); font-weight: 300; }
.matrix-dim { font-size: 0.68rem; color: var(--fg-muted); text-align: center; margin-top: 4px; }

/* ============ GPU HARDWARE DIAGRAM ============ */
.gpu-chip {
  background: linear-gradient(145deg, #1a1a2e, #0f0f1a);
  border: 2px solid var(--border); border-radius: 20px;
  padding: 24px; max-width: 900px; margin: 0 auto; position: relative;
}
.gpu-chip-label {
  position: absolute; top: -12px; left: 28px;
  background: var(--bg-section-alt); padding: 0 12px;
  font-size: 0.82rem; font-weight: 600; color: var(--secondary);
  font-family: var(--font-mono);
}
.sm-grid {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
  gap: 6px; margin-top: 16px;
}
.sm-unit {
  background: rgba(0,0,0,0.4); border: 1px solid var(--border); border-radius: 8px;
  padding: 8px 4px; text-align: center; font-size: 0.6rem;
  font-family: var(--font-mono); color: var(--fg-muted);
  transition: all 0.3s; cursor: default; position: relative;
}
.sm-unit.active { border-color: var(--primary); background: rgba(0,212,106,0.08); color: var(--primary); }
.sm-unit.partial { border-color: var(--yellow); background: rgba(255,202,40,0.08); color: var(--yellow); }
.sm-unit.idle { border-color: var(--border); background: rgba(0,0,0,0.3); color: #555; }
.sm-unit-id { font-weight: 700; font-size: 0.68rem; }
.sm-blocks-count { font-size: 0.55rem; margin-top: 2px; }
.gpu-legend {
  display: flex; gap: 20px; margin-top: 16px; justify-content: center; flex-wrap: wrap;
}
.legend-item { display: flex; align-items: center; gap: 6px; font-size: 0.75rem; color: var(--fg-muted); }
.legend-dot { width: 10px; height: 10px; border-radius: 3px; }

/* ============ THREAD BLOCK DIAGRAM ============ */
.block-diagram {
  background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px;
  padding: 28px; margin: 24px 0;
}
.thread-grid-visual {
  display: grid; gap: 1px; margin: 16px auto; width: fit-content;
}
.thread-cell {
  width: 6px; height: 6px; border-radius: 1px; transition: all 0.3s;
}
.warp-colors .thread-cell:nth-child(32n+1) { border-left: 2px solid var(--primary); }

/* ============ INTERACTIVE CALCULATOR ============ */
.calc-container {
  background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px;
  padding: 32px; margin: 24px 0;
}
.calc-row {
  display: flex; align-items: center; gap: 16px; margin: 12px 0; flex-wrap: wrap;
}
.calc-label {
  font-size: 0.85rem; font-weight: 500; color: var(--fg-muted); min-width: 200px;
}
.calc-input {
  background: rgba(0,0,0,0.3); border: 1px solid var(--border); border-radius: 8px;
  padding: 10px 16px; color: var(--fg); font-family: var(--font-mono);
  font-size: 0.88rem; width: 140px; transition: border-color 0.2s;
}
.calc-input:focus { outline: none; border-color: var(--primary); }
.calc-result {
  font-family: var(--font-mono); font-size: 0.88rem; color: var(--secondary);
  background: rgba(0,200,230,0.06); padding: 4px 12px; border-radius: 6px;
}
.calc-divider {
  width: 100%; height: 1px; background: var(--border); margin: 20px 0;
}
.calc-big-result {
  text-align: center; padding: 20px; margin-top: 16px;
  background: rgba(0,212,106,0.04); border: 1px solid rgba(0,212,106,0.2);
  border-radius: 12px;
}
.calc-big-number {
  font-size: 3rem; font-weight: 700; font-family: var(--font-mono);
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}
.calc-big-label { font-size: 0.82rem; color: var(--fg-muted); margin-top: 4px; }

/* ============ EFFICIENCY BAR ============ */
.eff-bar-container {
  margin: 20px 0;
}
.eff-bar-track {
  height: 40px; background: rgba(255,255,255,0.03); border-radius: 8px;
  overflow: hidden; position: relative; border: 1px solid var(--border);
}
.eff-bar-fill {
  height: 100%; border-radius: 8px; display: flex; align-items: center;
  justify-content: center; font-size: 0.82rem; font-weight: 700;
  font-family: var(--font-mono); color: #fff; transition: width 0.6s ease;
  position: relative;
}
.eff-bar-fill.good { background: linear-gradient(90deg, var(--primary), var(--secondary)); }
.eff-bar-fill.medium { background: linear-gradient(90deg, var(--yellow), var(--orange)); }
.eff-bar-fill.bad { background: linear-gradient(90deg, var(--red), var(--pink)); }
.eff-bar-labels {
  display: flex; justify-content: space-between; font-size: 0.72rem;
  color: var(--fg-muted); margin-top: 6px; font-family: var(--font-mono);
}

/* ============ STEP-BY-STEP FLOW ============ */
.flow-container {
  display: flex; flex-direction: column; gap: 0; margin: 24px 0;
  max-width: 800px; margin-left: auto; margin-right: auto;
}
.flow-step {
  display: flex; gap: 20px; align-items: flex-start; position: relative;
  padding: 20px 0;
}
.flow-num {
  width: 44px; height: 44px; border-radius: 50%; display: flex;
  align-items: center; justify-content: center; font-weight: 700;
  font-family: var(--font-mono); font-size: 0.88rem; flex-shrink: 0;
  background: rgba(0,212,106,0.08); border: 2px solid var(--primary); color: var(--primary);
}
.flow-connector {
  position: absolute; left: 21px; top: 64px; bottom: -20px;
  width: 2px; background: var(--border);
}
.flow-step:last-child .flow-connector { display: none; }
.flow-body { flex: 1; }
.flow-title { font-size: 1.05rem; font-weight: 600; margin-bottom: 6px; }
.flow-desc { font-size: 0.85rem; color: var(--fg-muted); line-height: 1.6; }

/* ============ OCCUPANCY VIS ============ */
.occupancy-vis {
  display: flex; gap: 4px; height: 120px; align-items: flex-end;
  justify-content: center; margin: 16px 0;
}
.occ-bar {
  width: 28px; border-radius: 4px 4px 0 0; display: flex;
  flex-direction: column; align-items: center; justify-content: flex-end;
  font-size: 0.55rem; font-weight: 600; color: #fff; padding-bottom: 4px;
  transition: height 0.5s;
}
.occ-bar-label {
  font-size: 0.6rem; color: var(--fg-muted); text-align: center;
  margin-top: 4px; font-family: var(--font-mono);
}

/* ============ PROFILER TABLE ============ */
.prof-table {
  width: 100%; border-collapse: separate; border-spacing: 0;
  background: var(--bg-card); border-radius: 12px; overflow: hidden;
  border: 1px solid var(--border); margin: 20px 0;
}
.prof-table th {
  padding: 14px 16px; font-size: 0.78rem; font-weight: 600;
  text-transform: uppercase; letter-spacing: 0.5px;
  background: rgba(0,212,106,0.06); color: var(--primary); text-align: left;
}
.prof-table td {
  padding: 12px 16px; font-size: 0.85rem; border-top: 1px solid var(--border);
  color: var(--fg-muted); font-family: var(--font-mono);
}
.prof-table tr:hover td { background: rgba(255,255,255,0.02); }
.val-good { color: var(--green) !important; font-weight: 600; }
.val-bad { color: var(--red) !important; font-weight: 600; }
.val-neutral { color: var(--yellow) !important; font-weight: 600; }

/* ============ INTERACTIVE SM VISUALIZER ============ */
.sim-container {
  background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px;
  padding: 28px; margin: 24px 0;
}
.sim-controls {
  display: flex; gap: 12px; margin-bottom: 20px; flex-wrap: wrap; align-items: center;
}
.sim-btn {
  padding: 8px 20px; border-radius: 8px; border: 1px solid var(--border);
  background: var(--bg); color: var(--fg); font-size: 0.82rem; font-weight: 500;
  cursor: pointer; transition: all 0.2s; font-family: var(--font-sans);
}
.sim-btn:hover { border-color: var(--primary); color: var(--primary); }
.sim-btn.active { background: rgba(0,212,106,0.12); border-color: var(--primary); color: var(--primary); }

.slider-group { display: flex; align-items: center; gap: 8px; }
.slider-group label { font-size: 0.78rem; color: var(--fg-muted); white-space: nowrap; }
.slider-group input[type="range"] {
  -webkit-appearance: none; height: 4px; background: var(--border);
  border-radius: 4px; outline: none; cursor: pointer;
}
.slider-group input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none; width: 16px; height: 16px; background: var(--primary);
  border-radius: 50%; cursor: pointer;
}
.slider-val {
  font-family: var(--font-mono); font-size: 0.78rem; color: var(--secondary);
  min-width: 40px; text-align: right;
}

/* ============ MATMUL ANIMATION ============ */
.matmul-anim-area {
  position: relative; min-height: 300px; margin: 20px 0;
  display: flex; align-items: center; justify-content: center; gap: 24px;
}

/* ============ CONCEPT ARROW */
.arrow-down {
  display: flex; flex-direction: column; align-items: center; gap: 4px;
  margin: 32px 0; color: var(--fg-muted);
}
.arrow-down svg { animation: bounce-down 2s ease-in-out infinite; }
@keyframes bounce-down {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(8px); }
}
.arrow-label { font-size: 0.78rem; font-weight: 600; color: var(--primary); }

/* ============ TILE OVERLAY ============ */
.tile-overlay {
  position: absolute; pointer-events: none; border: 2px dashed var(--primary);
  border-radius: 4px; opacity: 0; transition: all 0.4s;
}
.tile-overlay.visible { opacity: 1; pointer-events: auto; }
.tile-label {
  position: absolute; top: -20px; left: 50%; transform: translateX(-50%);
  font-size: 0.6rem; font-weight: 700; color: var(--primary);
  font-family: var(--font-mono); white-space: nowrap;
}

/* ============ HIERARCHY DIAGRAM ============ */
.hierarchy {
  display: flex; flex-direction: column; align-items: center; gap: 0;
  margin: 24px 0;
}
.hier-level {
  display: flex; align-items: center; gap: 12px; padding: 16px 24px;
  border-radius: 12px; border: 1px solid var(--border); min-width: 320px;
  transition: all 0.3s; cursor: default;
}
.hier-level:hover { border-color: rgba(0,212,106,0.3); }
.hier-icon {
  width: 44px; height: 44px; border-radius: 10px; display: flex;
  align-items: center; justify-content: center; font-size: 1.2rem;
  flex-shrink: 0;
}
.hier-text { flex: 1; }
.hier-name { font-weight: 600; font-size: 0.95rem; }
.hier-desc { font-size: 0.75rem; color: var(--fg-muted); }
.hier-connector {
  width: 2px; height: 20px; background: var(--border);
}

/* RESPONSIVE */
@media (max-width: 768px) {
  .hero h1 { font-size: 2.2rem; }
  .grid-2, .grid-3, .grid-4 { grid-template-columns: 1fr; }
  .calc-row { flex-direction: column; align-items: flex-start; }
  .calc-label { min-width: auto; }
  .sm-grid { grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); }
}
</style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar">
  <div class="nav-inner">
    <div class="nav-brand">
      <span>Vizuara</span>
      <span class="brand-tag">GPU Efficiency</span>
    </div>
    <div class="nav-links">
      <a href="#matmul">MatMul</a>
      <a href="#gpu-hw">GPU Hardware</a>
      <a href="#hierarchy">Thread Hierarchy</a>
      <a href="#who-decides">Who Decides?</a>
      <a href="#mapping">Kernel Launch</a>
      <a href="#sm-eff">SM Efficiency</a>
      <a href="#occupancy">Occupancy</a>
      <a href="#calculator">Calculator</a>
      <a href="#profiler">Profiler</a>
      <a href="#takeaways">Takeaways</a>
    </div>
  </div>
</nav>

<!-- HERO -->
<section class="hero">
  <div class="hero-bg-orbs">
    <div class="orb orb-green"></div>
    <div class="orb orb-cyan"></div>
    <div class="orb orb-purple"></div>
  </div>
  <div class="hero-content">
    <div class="hero-badge"><span class="pulse-dot"></span> GPU Deep Dive &mdash; From First Principles</div>
    <h1><span class="gradient-text">GPU Efficiency</span> &amp; SM Utilization</h1>
    <p class="hero-subtitle">You have a matrix multiplication. You have a GPU. What happens next? A from-scratch walkthrough of <strong>grids, blocks, SMs, warps</strong>, and how GPU efficiency is actually calculated in TensorBoard.</p>
    <div class="hero-cards">
      <div class="hero-stat-card">
        <div class="stat-number">108 SMs</div>
        <div class="stat-label">A100 GPU (80GB)</div>
      </div>
      <div class="hero-stat-card">
        <div class="stat-number">Grid</div>
        <div class="stat-label">How blocks are organized</div>
      </div>
      <div class="hero-stat-card">
        <div class="stat-number">Block</div>
        <div class="stat-label">Group of threads on 1 SM</div>
      </div>
      <div class="hero-stat-card">
        <div class="stat-number">Warp</div>
        <div class="stat-label">32 threads in lockstep</div>
      </div>
    </div>
  </div>
</section>

<!-- ============ SECTION 1: THE MATRIX MULTIPLICATION ============ -->
<section class="section" id="matmul">
  <div class="container">
    <div class="section-heading">
      <div class="section-label">Step 1 &mdash; The Starting Point</div>
      <h2><span class="gradient-text">You Have a Matrix Multiplication</span></h2>
      <p class="section-subtitle">Almost everything in deep learning &mdash; forward passes, backward passes, attention &mdash; boils down to matrix multiplications. Let's start with a concrete one.</p>
    </div>

    <div class="fade-in" style="max-width: 900px; margin: 0 auto;">
      <div class="card">
        <h3>The Operation: C = A &times; B</h3>
        <p>From our training code, the forward pass of a single linear layer does:</p>
        <div class="code-block" style="margin: 16px 0;">
          <span class="cm"># Linear layer: output = input @ weight.T</span><br>
          <span class="cm"># input shape:  [64, 4096]  (batch_size x hidden_dim)</span><br>
          <span class="cm"># weight shape: [4096, 4096] (hidden_dim x hidden_dim)</span><br>
          <span class="cm"># output shape: [64, 4096]</span><br><br>
          output = input <span class="kw">@</span> weight.T &nbsp;&nbsp;<span class="cm"># This is a matrix multiplication!</span>
        </div>

        <p style="margin-top: 16px;">Each element of the output matrix C[i][j] requires computing a <strong>dot product</strong> &mdash; multiply corresponding elements of row i from A and column j from B, then sum them all up.</p>

        <div class="equation-box">
          <span class="eq-label">Total multiply-add operations</span>
          C[i][j] = &sum;<sub>k=0..4095</sub> A[i][k] &times; B[k][j] &nbsp;&nbsp;&rarr;&nbsp;&nbsp; <span class="eq-highlight">64 &times; 4096 &times; 4096 = 1.07 billion</span> operations
        </div>
      </div>

      <div class="callout callout-info" style="margin-top: 20px;">
        <strong>Key question:</strong> We have 1.07 billion independent multiply-add operations. A single CPU core does them one by one. A GPU has <strong>thousands of cores</strong> that can do many of them simultaneously. But how does the GPU organize this work?
      </div>

      <div class="arrow-down">
        <span class="arrow-label">Let's look at the GPU</span>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M12 5v14M5 12l7 7 7-7"/></svg>
      </div>
    </div>
  </div>
</section>

<!-- ============ SECTION 2: GPU HARDWARE ============ -->
<section class="section section-dark" id="gpu-hw">
  <div class="container">
    <div class="section-heading">
      <div class="section-label">Step 2 &mdash; The Hardware</div>
      <h2><span class="gradient-text">Inside the GPU: Streaming Multiprocessors</span></h2>
      <p class="section-subtitle">A GPU is not just "lots of cores". It's organized into <strong>Streaming Multiprocessors (SMs)</strong> &mdash; semi-independent processors, each with their own cores, registers, and shared memory.</p>
    </div>

    <div class="fade-in" style="max-width: 900px; margin: 0 auto;">
      <!-- GPU chip visual -->
      <div class="gpu-chip">
        <div class="gpu-chip-label">NVIDIA A100 GPU</div>
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; flex-wrap: wrap; gap: 8px;">
          <span style="font-size: 0.82rem; color: var(--fg-muted);">108 Streaming Multiprocessors</span>
          <span style="font-size: 0.72rem; color: var(--secondary); font-family: var(--font-mono);">80 GB HBM2e &bull; 2 TB/s bandwidth</span>
        </div>
        <div class="sm-grid" id="smGrid">
          <!-- Filled by JS -->
        </div>
        <div class="gpu-legend">
          <div class="legend-item"><div class="legend-dot" style="background: var(--primary);"></div> Fully active SM</div>
          <div class="legend-item"><div class="legend-dot" style="background: var(--yellow);"></div> Partially active SM</div>
          <div class="legend-item"><div class="legend-dot" style="background: #333;"></div> Idle SM</div>
        </div>
      </div>

      <div class="grid-2 fade-in" style="margin-top: 24px;">
        <div class="card">
          <h3>What's Inside Each SM?</h3>
          <ul style="list-style: none; margin-top: 12px;">
            <li style="padding: 6px 0; border-bottom: 1px solid var(--border);"><code>64</code> FP32 CUDA Cores</li>
            <li style="padding: 6px 0; border-bottom: 1px solid var(--border);"><code>32</code> FP64 Cores</li>
            <li style="padding: 6px 0; border-bottom: 1px solid var(--border);"><code>4</code> Tensor Cores (TF32/FP16/BF16)</li>
            <li style="padding: 6px 0; border-bottom: 1px solid var(--border);"><code>256 KB</code> Register File</li>
            <li style="padding: 6px 0; border-bottom: 1px solid var(--border);"><code>192 KB</code> Shared Memory / L1 Cache</li>
            <li style="padding: 6px 0;"><code>4</code> Warp Schedulers</li>
          </ul>
        </div>
        <div class="card">
          <h3>Think of an SM Like a Factory Floor</h3>
          <p>Each SM is like a small factory with its own workers (cores), local storage (registers + shared memory), and a manager (warp scheduler).</p>
          <p style="margin-top: 12px;">The GPU is a <strong>collection of 108 factories</strong>. Work gets divided up and assigned to these factories. The question is: <strong>how many factories are actually busy?</strong> That's SM efficiency.</p>
          <div class="equation-box" style="margin-top: 16px;">
            <span class="eq-label">The goal</span>
            Keep as many SMs busy as possible &rarr; <span class="eq-highlight">High SM Efficiency</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ============ SECTION 3: CUDA THREAD HIERARCHY ============ -->
<section class="section" id="hierarchy">
  <div class="container">
    <div class="section-heading">
      <div class="section-label">Step 3 &mdash; The Thread Hierarchy</div>
      <h2><span class="gradient-text">Threads, Warps, Blocks, and Grids</span></h2>
      <p class="section-subtitle">CUDA organizes parallel work into a hierarchy. Understanding this hierarchy is key to understanding GPU efficiency.</p>
    </div>

    <div class="fade-in" style="max-width: 800px; margin: 0 auto;">
      <!-- Hierarchy diagram -->
      <div class="hierarchy">
        <div class="hier-level" style="border-color: var(--accent); background: rgba(167,139,250,0.04);">
          <div class="hier-icon" style="background: rgba(167,139,250,0.15); color: var(--accent);">G</div>
          <div class="hier-text">
            <div class="hier-name" style="color: var(--accent);">Grid</div>
            <div class="hier-desc">The entire kernel launch. Contains all blocks. One grid = one kernel call.</div>
          </div>
          <div style="font-family: var(--font-mono); font-size: 0.75rem; color: var(--accent);">[16, 32, 1]</div>
        </div>
        <div class="hier-connector"></div>
        <div class="hier-level" style="border-color: var(--blue); background: rgba(66,165,245,0.04);">
          <div class="hier-icon" style="background: rgba(66,165,245,0.15); color: var(--blue);">B</div>
          <div class="hier-text">
            <div class="hier-name" style="color: var(--blue);">Block (Thread Block)</div>
            <div class="hier-desc">A group of threads that execute on <strong>one SM</strong>. Threads in a block can share memory and synchronize.</div>
          </div>
          <div style="font-family: var(--font-mono); font-size: 0.75rem; color: var(--blue);">[128, 1, 1]</div>
        </div>
        <div class="hier-connector"></div>
        <div class="hier-level" style="border-color: var(--primary); background: rgba(0,212,106,0.04);">
          <div class="hier-icon" style="background: rgba(0,212,106,0.15); color: var(--primary);">W</div>
          <div class="hier-text">
            <div class="hier-name" style="color: var(--primary);">Warp</div>
            <div class="hier-desc">32 threads that execute the <strong>same instruction</strong> in lockstep (SIMT). The fundamental scheduling unit.</div>
          </div>
          <div style="font-family: var(--font-mono); font-size: 0.75rem; color: var(--primary);">32 threads</div>
        </div>
        <div class="hier-connector"></div>
        <div class="hier-level" style="border-color: var(--pink); background: rgba(240,98,146,0.04);">
          <div class="hier-icon" style="background: rgba(240,98,146,0.15); color: var(--pink);">T</div>
          <div class="hier-text">
            <div class="hier-name" style="color: var(--pink);">Thread</div>
            <div class="hier-desc">The smallest unit of execution. Each thread computes one (or a few) output elements.</div>
          </div>
          <div style="font-family: var(--font-mono); font-size: 0.75rem; color: var(--pink);">1 element</div>
        </div>
      </div>

      <!-- Concrete example -->
      <div class="card fade-in" style="margin-top: 32px;">
        <h3>Concrete Example from TensorBoard</h3>
        <p>The profiler shows the matmul kernel was launched with:</p>

        <div class="grid-2" style="margin-top: 16px; gap: 16px;">
          <div style="background: rgba(167,139,250,0.06); border: 1px solid rgba(167,139,250,0.2); border-radius: 10px; padding: 16px;">
            <div style="font-size: 0.72rem; text-transform: uppercase; letter-spacing: 1px; color: var(--accent); margin-bottom: 8px;">Grid Dimensions</div>
            <div style="font-family: var(--font-mono); font-size: 1.1rem; font-weight: 700; color: var(--fg);">[16, 32, 1]</div>
            <div style="font-size: 0.78rem; color: var(--fg-muted); margin-top: 8px;">
              Total blocks = 16 &times; 32 &times; 1 = <strong style="color: var(--accent);">512 blocks</strong>
            </div>
          </div>
          <div style="background: rgba(66,165,245,0.06); border: 1px solid rgba(66,165,245,0.2); border-radius: 10px; padding: 16px;">
            <div style="font-size: 0.72rem; text-transform: uppercase; letter-spacing: 1px; color: var(--blue); margin-bottom: 8px;">Block Dimensions</div>
            <div style="font-family: var(--font-mono); font-size: 1.1rem; font-weight: 700; color: var(--fg);">[128, 1, 1]</div>
            <div style="font-size: 0.78rem; color: var(--fg-muted); margin-top: 8px;">
              Threads per block = 128 &times; 1 &times; 1 = <strong style="color: var(--blue);">128 threads/block</strong>
            </div>
          </div>
        </div>

        <div class="equation-box" style="margin-top: 16px;">
          <span class="eq-label">Total threads launched</span>
          <span class="eq-highlight">512</span> blocks &times; <span class="eq-highlight">128</span> threads/block = <span class="eq-highlight">65,536</span> total threads
        </div>

        <div style="font-size: 0.85rem; color: var(--fg-muted); margin-top: 12px;">
          <strong style="color: var(--fg);">Warps per block:</strong> 128 threads &divide; 32 threads/warp = <strong style="color: var(--primary);">4 warps per block</strong><br>
          <strong style="color: var(--fg);">Total warps:</strong> 512 blocks &times; 4 warps = <strong style="color: var(--primary);">2,048 warps</strong>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ============ SECTION 3.5: WHO DECIDES GRID & BLOCK? ============ -->
<section class="section section-dark" id="who-decides">
  <div class="container">
    <div class="section-heading">
      <div class="section-label">Step 3.5 &mdash; The Key Question</div>
      <h2><span class="gradient-text">Who Decides Grid &amp; Block Dimensions?</span></h2>
      <p class="section-subtitle">You see <code>grid [16, 32, 1]</code> and <code>block [128, 1, 1]</code> in the profiler. But who chose these numbers? It depends on <strong>who wrote the kernel</strong>.</p>
    </div>

    <div class="fade-in" style="max-width: 900px; margin: 0 auto;">

      <!-- Two paths -->
      <div class="grid-2">
        <div class="card" style="border-top: 3px solid var(--accent);">
          <h3 style="color: var(--accent);">Path A: Library Kernels (Your Case)</h3>
          <p>When you write <code>output = input @ weight.T</code> in PyTorch, you're <strong>not</strong> writing a CUDA kernel yourself. Under the hood:</p>
          <div class="flow-container" style="margin: 16px 0;">
            <div class="flow-step" style="padding: 10px 0;">
              <div class="flow-num" style="width:32px;height:32px;font-size:0.72rem;">1</div>
              <div class="flow-connector" style="top:52px;"></div>
              <div class="flow-body">
                <div class="flow-desc">PyTorch calls <code>torch.mm()</code> or <code>torch.matmul()</code></div>
              </div>
            </div>
            <div class="flow-step" style="padding: 10px 0;">
              <div class="flow-num" style="width:32px;height:32px;font-size:0.72rem;">2</div>
              <div class="flow-connector" style="top:52px;"></div>
              <div class="flow-body">
                <div class="flow-desc">Which calls <strong>cuBLAS</strong> (NVIDIA's optimized BLAS library)</div>
              </div>
            </div>
            <div class="flow-step" style="padding: 10px 0;">
              <div class="flow-num" style="width:32px;height:32px;font-size:0.72rem;">3</div>
              <div class="flow-connector" style="top:52px;"></div>
              <div class="flow-body">
                <div class="flow-desc">cuBLAS has <strong>hundreds of pre-written kernels</strong> for different matrix shapes</div>
              </div>
            </div>
            <div class="flow-step" style="padding: 10px 0;">
              <div class="flow-num" style="width:32px;height:32px;font-size:0.72rem;">4</div>
              <div class="flow-body">
                <div class="flow-desc">cuBLAS <strong>auto-selects</strong> the best kernel + grid/block config via heuristics &amp; autotuning</div>
              </div>
            </div>
          </div>
          <div class="callout callout-info" style="margin-top: 8px;">
            <strong>You don't choose anything.</strong> cuBLAS picked grid <code>[16,32,1]</code> and block <code>[128,1,1]</code> because its internal heuristics determined this is optimal for a <code>[64,4096] &times; [4096,4096]</code> multiply on an A100.
          </div>
        </div>

        <div class="card" style="border-top: 3px solid var(--pink);">
          <h3 style="color: var(--pink);">Path B: Custom CUDA Kernels</h3>
          <p>If <strong>you</strong> write a CUDA kernel (e.g., in Triton or raw CUDA C++), then <strong>you decide</strong> the grid and block dimensions.</p>
          <div class="code-block" style="margin: 16px 0; font-size: 0.75rem;">
            <span class="cm">// You choose TILE_M, TILE_N, THREADS</span><br>
            <span class="kw">#define</span> TILE_M <span class="num">4</span>   <span class="cm">// rows per block</span><br>
            <span class="kw">#define</span> TILE_N <span class="num">128</span> <span class="cm">// cols per block</span><br>
            <span class="kw">#define</span> THREADS <span class="num">128</span><br><br>
            <span class="cm">// Grid = how many tiles to cover output C</span><br>
            dim3 <span class="fn">grid</span>(<br>
            &nbsp;&nbsp;ceil(M / TILE_M), <span class="cm">// = 64/4 = 16</span><br>
            &nbsp;&nbsp;ceil(N / TILE_N), <span class="cm">// = 4096/128 = 32</span><br>
            &nbsp;&nbsp;<span class="num">1</span><br>
            );<br>
            dim3 <span class="fn">block</span>(THREADS, <span class="num">1</span>, <span class="num">1</span>);<br><br>
            <span class="cm">// Launch!</span><br>
            matmul_kernel<span class="kw">&lt;&lt;&lt;</span>grid, block<span class="kw">&gt;&gt;&gt;</span>(A, B, C);
          </div>
          <div class="callout callout-warn" style="margin-top: 8px;">
            <strong>You choose everything.</strong> The tile sizes and thread count determine both grid and block dimensions. Bad choices = low SM efficiency or low occupancy.
          </div>
        </div>
      </div>

      <!-- How the numbers are derived -->
      <div class="card fade-in" style="margin-top: 32px;">
        <h3>How Grid [16, 32, 1] Was Derived (The Logic)</h3>
        <p style="margin-bottom: 16px;">Whether cuBLAS or you decide, the <strong>logic</strong> is the same. The output matrix C has shape <code>[M, N]</code>. Each block computes one <strong>tile</strong> of C:</p>

        <div style="display: flex; gap: 24px; align-items: flex-start; flex-wrap: wrap; margin-bottom: 20px;">
          <!-- Left: the tiling diagram -->
          <div style="flex: 1; min-width: 300px;">
            <div style="font-size: 0.82rem; font-weight: 600; margin-bottom: 12px; color: var(--secondary);">Output Matrix C [64 &times; 4096]</div>
            <div style="position: relative; width: 100%; max-width: 400px;">
              <!-- C matrix as a grid of tiles -->
              <svg viewBox="0 0 400 80" style="width: 100%;" xmlns="http://www.w3.org/2000/svg">
                <!-- Background -->
                <rect x="0" y="0" width="400" height="80" rx="6" fill="rgba(0,212,106,0.05)" stroke="rgba(0,212,106,0.3)" stroke-width="1.5"/>
                <!-- Horizontal tile lines (16 rows / TILE_M=4 → 16 strips, but matrix is short so show a few) -->
                <line x1="0" y1="20" x2="400" y2="20" stroke="rgba(240,98,146,0.4)" stroke-dasharray="4,3"/>
                <line x1="0" y1="40" x2="400" y2="40" stroke="rgba(240,98,146,0.4)" stroke-dasharray="4,3"/>
                <line x1="0" y1="60" x2="400" y2="60" stroke="rgba(240,98,146,0.4)" stroke-dasharray="4,3"/>
                <!-- Vertical tile lines (32 cols) - show a few -->
                <line x1="12.5" y1="0" x2="12.5" y2="80" stroke="rgba(66,165,245,0.4)" stroke-dasharray="4,3"/>
                <line x1="25" y1="0" x2="25" y2="80" stroke="rgba(66,165,245,0.4)" stroke-dasharray="4,3"/>
                <line x1="37.5" y1="0" x2="37.5" y2="80" stroke="rgba(66,165,245,0.4)" stroke-dasharray="4,3"/>
                <line x1="50" y1="0" x2="50" y2="80" stroke="rgba(66,165,245,0.4)" stroke-dasharray="4,3"/>
                <line x1="62.5" y1="0" x2="62.5" y2="80" stroke="rgba(66,165,245,0.4)" stroke-dasharray="4,3"/>
                <!-- More vertical lines -->
                <line x1="100" y1="0" x2="100" y2="80" stroke="rgba(66,165,245,0.4)" stroke-dasharray="4,3"/>
                <line x1="200" y1="0" x2="200" y2="80" stroke="rgba(66,165,245,0.4)" stroke-dasharray="4,3"/>
                <line x1="300" y1="0" x2="300" y2="80" stroke="rgba(66,165,245,0.4)" stroke-dasharray="4,3"/>
                <!-- Highlight one tile -->
                <rect x="1" y="1" width="12" height="19" rx="2" fill="rgba(0,212,106,0.25)" stroke="var(--primary)" stroke-width="1.5"/>
                <text x="7" y="13" text-anchor="middle" fill="white" font-size="5" font-family="JetBrains Mono" font-weight="700">B0</text>
                <!-- Another tile -->
                <rect x="13" y="1" width="12" height="19" rx="2" fill="rgba(167,139,250,0.15)" stroke="rgba(167,139,250,0.5)" stroke-width="1"/>
                <text x="19" y="13" text-anchor="middle" fill="rgba(167,139,250,0.8)" font-size="5" font-family="JetBrains Mono" font-weight="600">B1</text>
                <!-- Labels -->
                <text x="200" y="75" text-anchor="middle" fill="rgba(255,255,255,0.4)" font-size="7" font-family="Inter">... 512 tiles total (16 rows &times; 32 cols) ...</text>
              </svg>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 0.72rem; color: var(--fg-muted); font-family: var(--font-mono);">
              <span>&larr; N = 4096 cols &rarr;</span>
              <span>M = 64 rows &darr;</span>
            </div>
          </div>

          <!-- Right: the math -->
          <div style="flex: 1; min-width: 280px;">
            <div class="equation-box">
              <span class="eq-label">Grid X (tiles along M)</span>
              ceil(<span class="eq-highlight">M</span> / <span class="eq-highlight">TILE_M</span>) = ceil(64 / 4) = <span class="eq-highlight">16</span>
            </div>
            <div class="equation-box">
              <span class="eq-label">Grid Y (tiles along N)</span>
              ceil(<span class="eq-highlight">N</span> / <span class="eq-highlight">TILE_N</span>) = ceil(4096 / 128) = <span class="eq-highlight">32</span>
            </div>
            <div class="equation-box">
              <span class="eq-label">Grid Z</span>
              <span class="eq-highlight">1</span> (no batch dimension in grid)
            </div>
            <div class="equation-box" style="border-color: rgba(0,212,106,0.4);">
              <span class="eq-label">Result</span>
              grid = [<span class="eq-highlight">16</span>, <span class="eq-highlight">32</span>, <span class="eq-highlight">1</span>] &rarr; 512 blocks
            </div>
          </div>
        </div>

        <p style="font-size: 0.85rem; color: var(--fg-muted);">Each tile is a <strong>4 &times; 128</strong> chunk of the output matrix. One block of 128 threads computes all 512 elements (4 &times; 128) in that tile. So <strong>each thread computes ~4 output elements</strong>.</p>
      </div>

      <!-- Block size: why 128? -->
      <div class="card fade-in" style="margin-top: 24px;">
        <h3>Why 128 Threads Per Block?</h3>
        <p>The block size (threads per block) is a critical choice. Here's the tradeoff:</p>

        <table class="prof-table" style="margin-top: 16px;">
          <thead>
            <tr>
              <th>Block Size</th>
              <th>Warps/Block</th>
              <th>Pros</th>
              <th>Cons</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>32</td>
              <td>1</td>
              <td style="font-size:0.8rem;">More blocks fit per SM, many blocks launched</td>
              <td style="font-size:0.8rem;">Fewer threads to cooperate in shared memory</td>
            </tr>
            <tr style="background: rgba(0,212,106,0.04);">
              <td class="val-good">128</td>
              <td class="val-good">4</td>
              <td style="font-size:0.8rem; color: var(--primary);">Good balance &mdash; enough warps for latency hiding, enough blocks for SM coverage</td>
              <td style="font-size:0.8rem;">&mdash;</td>
            </tr>
            <tr>
              <td>256</td>
              <td>8</td>
              <td style="font-size:0.8rem;">More warps per block for latency hiding</td>
              <td style="font-size:0.8rem;">Fewer blocks per SM, uses more registers per block</td>
            </tr>
            <tr>
              <td>1024</td>
              <td>32</td>
              <td style="font-size:0.8rem;">Maximum threads cooperating</td>
              <td style="font-size:0.8rem;">Only 1&ndash;2 blocks per SM, less flexibility</td>
            </tr>
          </tbody>
        </table>

        <div class="callout callout-success" style="margin-top: 16px;">
          <strong>In practice:</strong> For <code>nn.Linear</code> and matmul, <strong>cuBLAS decides for you</strong>. It tested many configurations during NVIDIA's development and the profiler just shows you what it picked. For custom kernels (Triton, raw CUDA), you have to experiment or use occupancy calculators.
        </div>
      </div>

      <!-- Decision summary -->
      <div class="card fade-in" style="margin-top: 24px; border-top: 3px solid var(--secondary);">
        <h3 style="color: var(--secondary);">Summary: The Decision Chain</h3>
        <div style="display: flex; gap: 0; align-items: stretch; margin-top: 16px; flex-wrap: wrap;">
          <div style="flex:1; min-width: 140px; padding: 16px; background: rgba(240,98,146,0.06); border-radius: 12px 0 0 12px; text-align: center;">
            <div style="font-size: 0.72rem; text-transform: uppercase; color: var(--pink); letter-spacing: 0.5px; margin-bottom: 6px;">You Write</div>
            <div style="font-family: var(--font-mono); font-size: 0.82rem; color: var(--fg);">output = input @ weight.T</div>
            <div style="font-size: 0.72rem; color: var(--fg-muted); margin-top: 4px;">matrix shapes: [64,4096] &times; [4096,4096]</div>
          </div>
          <div style="display: flex; align-items: center; padding: 0 6px; color: var(--fg-muted); font-size: 1.2rem;">&rarr;</div>
          <div style="flex:1; min-width: 140px; padding: 16px; background: rgba(167,139,250,0.06); text-align: center;">
            <div style="font-size: 0.72rem; text-transform: uppercase; color: var(--accent); letter-spacing: 0.5px; margin-bottom: 6px;">PyTorch Calls</div>
            <div style="font-family: var(--font-mono); font-size: 0.82rem; color: var(--fg);">cuBLAS gemm()</div>
            <div style="font-size: 0.72rem; color: var(--fg-muted); margin-top: 4px;">NVIDIA's matmul library</div>
          </div>
          <div style="display: flex; align-items: center; padding: 0 6px; color: var(--fg-muted); font-size: 1.2rem;">&rarr;</div>
          <div style="flex:1; min-width: 140px; padding: 16px; background: rgba(0,200,230,0.06); text-align: center;">
            <div style="font-size: 0.72rem; text-transform: uppercase; color: var(--secondary); letter-spacing: 0.5px; margin-bottom: 6px;">cuBLAS Decides</div>
            <div style="font-family: var(--font-mono); font-size: 0.82rem; color: var(--fg);">TILE_M=4, TILE_N=128</div>
            <div style="font-size: 0.72rem; color: var(--fg-muted); margin-top: 4px;">128 threads/block</div>
          </div>
          <div style="display: flex; align-items: center; padding: 0 6px; color: var(--fg-muted); font-size: 1.2rem;">&rarr;</div>
          <div style="flex:1; min-width: 140px; padding: 16px; background: rgba(0,212,106,0.06); border-radius: 0 12px 12px 0; text-align: center;">
            <div style="font-size: 0.72rem; text-transform: uppercase; color: var(--primary); letter-spacing: 0.5px; margin-bottom: 6px;">GPU Gets</div>
            <div style="font-family: var(--font-mono); font-size: 0.82rem; color: var(--fg);">grid [16,32,1]</div>
            <div style="font-family: var(--font-mono); font-size: 0.82rem; color: var(--fg);">block [128,1,1]</div>
          </div>
        </div>
      </div>

    </div>
  </div>
</section>

<!-- ============ SECTION 4: MAPPING TO HARDWARE ============ -->
<section class="section section-dark" id="mapping">
  <div class="container">
    <div class="section-heading">
      <div class="section-label">Step 4 &mdash; Mapping to Hardware</div>
      <h2><span class="gradient-text">How Blocks Get Assigned to SMs</span></h2>
      <p class="section-subtitle">You've launched 512 blocks. You have 108 SMs. The GPU scheduler now decides which blocks go where. This is the critical step for efficiency.</p>
    </div>

    <div class="fade-in" style="max-width: 900px; margin: 0 auto;">
      <!-- The assignment flow -->
      <div class="flow-container">
        <div class="flow-step">
          <div class="flow-num">1</div>
          <div class="flow-connector"></div>
          <div class="flow-body">
            <div class="flow-title">You launch the kernel</div>
            <div class="flow-desc">
              <code>matmul_kernel&lt;&lt;&lt;grid(16,32,1), block(128,1,1)&gt;&gt;&gt;(...)</code><br>
              This tells the GPU: "I have 512 blocks of work, each with 128 threads."
            </div>
          </div>
        </div>
        <div class="flow-step">
          <div class="flow-num">2</div>
          <div class="flow-connector"></div>
          <div class="flow-body">
            <div class="flow-title">GPU checks resource limits per SM</div>
            <div class="flow-desc">
              Each SM has finite resources. The scheduler checks: <strong>how many blocks can fit on one SM simultaneously?</strong> This depends on:
            </div>
            <div class="grid-3 fade-in" style="margin-top: 12px;">
              <div style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 12px; border: 1px solid var(--border);">
                <div style="font-size: 0.72rem; color: var(--secondary); text-transform: uppercase; letter-spacing: 0.5px;">Registers</div>
                <div style="font-size: 0.82rem; color: var(--fg-muted); margin-top: 4px;">122 regs/thread &times; 128 threads = 15,616 regs/block</div>
              </div>
              <div style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 12px; border: 1px solid var(--border);">
                <div style="font-size: 0.72rem; color: var(--secondary); text-transform: uppercase; letter-spacing: 0.5px;">Shared Memory</div>
                <div style="font-size: 0.82rem; color: var(--fg-muted); margin-top: 4px;">12,544 bytes per block</div>
              </div>
              <div style="background: rgba(0,0,0,0.3); border-radius: 8px; padding: 12px; border: 1px solid var(--border);">
                <div style="font-size: 0.72rem; color: var(--secondary); text-transform: uppercase; letter-spacing: 0.5px;">Max Blocks/SM</div>
                <div style="font-size: 0.82rem; color: var(--fg-muted); margin-top: 4px;">Hardware limit: 32 (A100)</div>
              </div>
            </div>
          </div>
        </div>
        <div class="flow-step">
          <div class="flow-num">3</div>
          <div class="flow-connector"></div>
          <div class="flow-body">
            <div class="flow-title">Scheduler assigns blocks in waves</div>
            <div class="flow-desc">
              The profiler tells us <code>blocks per SM = 4.74</code>. Since blocks can't be fractional, each SM runs about <strong>4&ndash;5 blocks concurrently</strong>. Blocks that don't fit wait for an SM to become free.
            </div>
            <div class="equation-box" style="margin-top: 12px;">
              <span class="eq-label">Blocks per SM (from profiler)</span>
              <span class="eq-highlight">4.740741</span> &asymp; 4&ndash;5 concurrent blocks per SM
            </div>
          </div>
        </div>
        <div class="flow-step">
          <div class="flow-num">4</div>
          <div class="flow-body">
            <div class="flow-title">512 blocks across 108 SMs</div>
            <div class="flow-desc">
              With ~4.74 blocks/SM, the GPU needs: 512 &divide; 4.74 &asymp; <strong>108 SMs</strong>. All 108 SMs are busy!
            </div>
            <div class="equation-box" style="margin-top: 12px;">
              <span class="eq-label">SMs needed</span>
              512 blocks &divide; 4.74 blocks/SM = <span class="eq-highlight">~108 SMs</span> (all of them!)
            </div>
          </div>
        </div>
      </div>

      <div class="callout callout-success">
        <strong>Good news:</strong> In this case, we have enough blocks (512) to keep all 108 SMs busy. But what if we had fewer blocks? That's where SM efficiency drops below 100%.
      </div>
    </div>
  </div>
</section>

<!-- ============ SECTION 5: SM EFFICIENCY ============ -->
<section class="section" id="sm-eff">
  <div class="container">
    <div class="section-heading">
      <div class="section-label">Step 5 &mdash; The Key Metric</div>
      <h2><span class="gradient-text">SM Efficiency: Are All Factories Busy?</span></h2>
      <p class="section-subtitle">SM Efficiency tells you what fraction of the GPU's streaming multiprocessors are actually doing work. It's the first thing to check when a kernel seems slow.</p>
    </div>

    <div class="fade-in" style="max-width: 900px; margin: 0 auto;">
      <div class="card">
        <h3>The Formula</h3>
        <p>SM Efficiency has a beautifully simple definition:</p>
        <div class="equation-box" style="margin-top: 16px; font-size: 1rem; padding: 24px;">
          <span class="eq-label">Estimated SM Efficiency</span>
          SM Efficiency = min( <span class="eq-highlight">blocks_launched</span> &divide; <span class="eq-highlight">num_SMs</span> , 1 )
        </div>
        <p style="margin-top: 16px;">In plain English: <strong>if you launch at least as many blocks as there are SMs, every SM gets work, and efficiency is 100%</strong>. If you launch fewer blocks than SMs, some SMs sit idle.</p>
      </div>

      <!-- Our example -->
      <div class="card fade-in" style="margin-top: 24px;">
        <h3>Our Matrix Multiply Example</h3>
        <div class="grid-2" style="margin-top: 16px;">
          <div>
            <div style="font-size: 0.82rem; color: var(--fg-muted); margin-bottom: 8px;">From TensorBoard:</div>
            <div class="prof-table" style="margin: 0;">
              <table style="width: 100%;">
                <tr><td style="color: var(--fg);">Grid</td><td>[16, 32, 1]</td></tr>
                <tr><td style="color: var(--fg);">Total blocks</td><td class="val-good">512</td></tr>
                <tr><td style="color: var(--fg);">Number of SMs</td><td>108</td></tr>
                <tr><td style="color: var(--fg);">Blocks per SM</td><td>4.740741</td></tr>
                <tr><td style="color: var(--fg);">Est. SM Efficiency</td><td class="val-good">1 (100%)</td></tr>
              </table>
            </div>
          </div>
          <div>
            <div style="font-size: 0.82rem; color: var(--fg-muted); margin-bottom: 8px;">Calculation:</div>
            <div class="equation-box">
              <span class="eq-label">Step 1: Total blocks</span>
              16 &times; 32 &times; 1 = <span class="eq-highlight">512</span>
            </div>
            <div class="equation-box">
              <span class="eq-label">Step 2: SM Efficiency</span>
              min(512 &divide; 108, 1) = min(4.74, 1) = <span class="eq-highlight">1</span>
            </div>
            <div style="text-align: center; margin-top: 12px; font-size: 0.88rem; color: var(--primary); font-weight: 600;">
              All 108 SMs are active!
            </div>
          </div>
        </div>
      </div>

      <!-- SM efficiency visualization -->
      <div class="sim-container fade-in" style="margin-top: 24px;">
        <h3 style="margin-bottom: 4px;">Interactive: What Happens When You Have Fewer Blocks?</h3>
        <p style="font-size: 0.82rem; color: var(--fg-muted); margin-bottom: 20px;">Drag the slider to change the total number of blocks and see how SM efficiency changes.</p>

        <div class="sim-controls">
          <div class="slider-group">
            <label>Total Blocks:</label>
            <input type="range" id="blockSlider" min="1" max="1024" value="512" style="width: 300px;">
            <span class="slider-val" id="blockSliderVal">512</span>
          </div>
          <div class="slider-group" style="margin-left: 24px;">
            <label>SMs:</label>
            <input type="range" id="smSlider" min="1" max="132" value="108" style="width: 120px;">
            <span class="slider-val" id="smSliderVal">108</span>
          </div>
        </div>

        <!-- Efficiency bar -->
        <div class="eff-bar-container">
          <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
            <span style="font-size: 0.82rem; font-weight: 600;">SM Efficiency</span>
            <span id="effValue" style="font-family: var(--font-mono); font-size: 0.88rem; font-weight: 700; color: var(--primary);">100%</span>
          </div>
          <div class="eff-bar-track">
            <div class="eff-bar-fill good" id="effBar" style="width: 100%;">100%</div>
          </div>
          <div class="eff-bar-labels">
            <span>0%</span>
            <span>25%</span>
            <span>50%</span>
            <span>75%</span>
            <span>100%</span>
          </div>
        </div>

        <!-- SM Grid visualization -->
        <div style="margin-top: 16px;">
          <div style="font-size: 0.82rem; font-weight: 600; margin-bottom: 8px;">SM Status Map <span style="font-weight: 400; color: var(--fg-muted);">(each square = 1 SM)</span></div>
          <div class="sm-grid" id="smGridInteractive" style="grid-template-columns: repeat(18, 1fr); gap: 4px;">
            <!-- Filled by JS -->
          </div>
        </div>

        <!-- Stats -->
        <div class="grid-3" style="margin-top: 16px;">
          <div class="equation-box">
            <span class="eq-label">Active SMs</span>
            <span id="activeSMs" class="eq-highlight">108</span> / <span id="totalSMs">108</span>
          </div>
          <div class="equation-box">
            <span class="eq-label">Blocks per SM</span>
            <span id="blocksPerSM" class="eq-highlight">4.74</span>
          </div>
          <div class="equation-box">
            <span class="eq-label">Idle SMs (wasted)</span>
            <span id="idleSMs" style="color: var(--red);">0</span>
          </div>
        </div>
      </div>

      <!-- When efficiency drops -->
      <div class="grid-2 fade-in" style="margin-top: 24px;">
        <div class="card" style="border-top: 3px solid var(--red);">
          <h3 style="color: var(--red);">Bad: SM Efficiency &lt; 100%</h3>
          <p>If you launch only <code>64</code> blocks on 108 SMs:</p>
          <div class="equation-box">
            min(64/108, 1) = <span style="color: var(--red); font-weight: 600;">0.59 (59%)</span>
          </div>
          <p style="margin-top: 8px;">44 SMs sit completely idle. You're paying for a full GPU but only using 59% of it.</p>
          <p style="margin-top: 8px;"><strong>Common causes:</strong> small batch size, small matrix dimensions, too-large block size.</p>
        </div>
        <div class="card" style="border-top: 3px solid var(--primary);">
          <h3 style="color: var(--primary);">Good: SM Efficiency = 100%</h3>
          <p>If you launch <code>512</code> blocks on 108 SMs:</p>
          <div class="equation-box">
            min(512/108, 1) = <span class="eq-highlight">1.0 (100%)</span>
          </div>
          <p style="margin-top: 8px;">Every SM has work. In fact, each SM has ~4.74 blocks queued, which also helps <strong>hide latency</strong> (while one block waits for memory, another can execute).</p>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ============ SECTION 6: OCCUPANCY ============ -->
<section class="section section-dark" id="occupancy">
  <div class="container">
    <div class="section-heading">
      <div class="section-label">Step 6 &mdash; Going Deeper</div>
      <h2><span class="gradient-text">Occupancy: How Busy is Each SM?</span></h2>
      <p class="section-subtitle">SM Efficiency tells you how many SMs are active. <strong>Occupancy</strong> tells you how efficiently each active SM is being used. They're different metrics!</p>
    </div>

    <div class="fade-in" style="max-width: 900px; margin: 0 auto;">
      <div class="grid-2">
        <div class="card">
          <h3>SM Efficiency vs Occupancy</h3>
          <p><strong>SM Efficiency:</strong> What % of SMs have at least one block?</p>
          <p style="margin-top: 8px;"><strong>Occupancy:</strong> What % of the maximum possible warps are active on each SM?</p>
          <div class="callout callout-info" style="margin-top: 16px;">
            You can have 100% SM Efficiency (all SMs busy) but low occupancy (each SM is underutilized).
          </div>
        </div>
        <div class="card">
          <h3>The Occupancy Formula</h3>
          <div class="equation-box">
            <span class="eq-label">Achieved Occupancy</span>
            active warps per SM &divide; <span class="eq-highlight">max warps per SM</span>
          </div>
          <p style="margin-top: 12px;">On the A100, each SM supports up to <strong>64 warps</strong> (2,048 threads). Our profiler shows:</p>
          <div class="equation-box">
            <span class="eq-label">From TensorBoard</span>
            warps per SM = 18.96 &rarr; occupancy = 18.96/64 = <span class="eq-highlight">~25%</span>
          </div>
        </div>
      </div>

      <!-- Visual: Occupancy -->
      <div class="card fade-in" style="margin-top: 24px;">
        <h3>Visualizing Occupancy on One SM</h3>
        <p>Each SM can run up to 64 warps (2,048 threads). Our kernel only fills ~19 warps. The rest of the SM's warp slots are empty.</p>

        <div style="display: flex; align-items: center; gap: 24px; margin-top: 20px; flex-wrap: wrap; justify-content: center;">
          <div style="text-align: center;">
            <div style="font-size: 0.78rem; color: var(--fg-muted); margin-bottom: 8px;">Warp Slots on One SM</div>
            <div id="occupancyGrid" style="display: grid; grid-template-columns: repeat(8, 1fr); gap: 3px; width: fit-content; margin: 0 auto;">
              <!-- 64 slots filled by JS -->
            </div>
            <div class="gpu-legend" style="margin-top: 12px;">
              <div class="legend-item"><div class="legend-dot" style="background: var(--primary);"></div> Active warp</div>
              <div class="legend-item"><div class="legend-dot" style="background: rgba(255,255,255,0.05);"></div> Empty slot</div>
            </div>
          </div>

          <div style="text-align: center; padding: 20px;">
            <div style="font-size: 3.5rem; font-weight: 700; font-family: var(--font-mono); color: var(--yellow);">25%</div>
            <div style="font-size: 0.82rem; color: var(--fg-muted);">Achieved Occupancy</div>
            <div style="font-size: 0.72rem; color: var(--fg-muted); margin-top: 4px;">~19 of 64 warp slots used</div>
          </div>
        </div>

        <div class="callout callout-warn" style="margin-top: 20px;">
          <strong>Why only 25% occupancy?</strong> Each block uses 128 threads (4 warps) and requires 122 registers per thread + 12,544 bytes of shared memory. With ~4&ndash;5 blocks per SM, that's only ~19 warps out of a possible 64. The bottleneck is <strong>register usage</strong> &mdash; each thread needs 122 registers, which limits how many blocks can coexist on one SM.
        </div>
      </div>

      <!-- Occupancy vs Performance -->
      <div class="card fade-in" style="margin-top: 24px;">
        <h3>Does Low Occupancy = Bad Performance?</h3>
        <p><strong>Not necessarily!</strong> Occupancy is a proxy metric, not a direct measure of performance.</p>
        <div class="grid-2" style="margin-top: 16px;">
          <div>
            <h4 style="font-size: 0.92rem; color: var(--green); margin-bottom: 8px;">When low occupancy is fine:</h4>
            <ul style="list-style: none;">
              <li style="padding: 4px 0; font-size: 0.82rem; color: var(--fg-muted);">&bull; Kernel is compute-bound (not waiting for memory)</li>
              <li style="padding: 4px 0; font-size: 0.82rem; color: var(--fg-muted);">&bull; Using Tensor Cores efficiently</li>
              <li style="padding: 4px 0; font-size: 0.82rem; color: var(--fg-muted);">&bull; High arithmetic intensity (lots of FLOPs per byte)</li>
            </ul>
          </div>
          <div>
            <h4 style="font-size: 0.92rem; color: var(--red); margin-bottom: 8px;">When low occupancy hurts:</h4>
            <ul style="list-style: none;">
              <li style="padding: 4px 0; font-size: 0.82rem; color: var(--fg-muted);">&bull; Kernel is memory-bound (waiting for data)</li>
              <li style="padding: 4px 0; font-size: 0.82rem; color: var(--fg-muted);">&bull; Not enough warps to hide memory latency</li>
              <li style="padding: 4px 0; font-size: 0.82rem; color: var(--fg-muted);">&bull; Many stalls visible in profiler</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ============ SECTION 7: INTERACTIVE CALCULATOR ============ -->
<section class="section" id="calculator">
  <div class="container">
    <div class="section-heading">
      <div class="section-label">Step 7 &mdash; Try It Yourself</div>
      <h2><span class="gradient-text">GPU Efficiency Calculator</span></h2>
      <p class="section-subtitle">Change the matrix dimensions, block size, or GPU model and see how SM efficiency and occupancy change in real time.</p>
    </div>

    <div class="calc-container fade-in" style="max-width: 900px; margin: 0 auto;">
      <!-- GPU Selection -->
      <div style="margin-bottom: 20px;">
        <div style="font-size: 0.82rem; font-weight: 600; margin-bottom: 8px;">GPU Model</div>
        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
          <button class="sim-btn gpu-preset" data-sms="84" data-warps="48" data-name="V100">V100 (84 SMs)</button>
          <button class="sim-btn gpu-preset active" data-sms="108" data-warps="64" data-name="A100">A100 (108 SMs)</button>
          <button class="sim-btn gpu-preset" data-sms="132" data-warps="64" data-name="H100">H100 (132 SMs)</button>
          <button class="sim-btn gpu-preset" data-sms="144" data-warps="64" data-name="B200">B200 (144 SMs)</button>
        </div>
      </div>

      <div class="calc-divider"></div>

      <!-- Matrix dimensions -->
      <div style="font-size: 0.88rem; font-weight: 600; margin-bottom: 12px;">Matrix Multiplication: C[M&times;N] = A[M&times;K] &times; B[K&times;N]</div>

      <div class="calc-row">
        <div class="calc-label">M (rows of output):</div>
        <input type="number" class="calc-input" id="calcM" value="64" min="1" max="65536">
      </div>
      <div class="calc-row">
        <div class="calc-label">N (cols of output):</div>
        <input type="number" class="calc-input" id="calcN" value="4096" min="1" max="65536">
      </div>
      <div class="calc-row">
        <div class="calc-label">K (inner dimension):</div>
        <input type="number" class="calc-input" id="calcK" value="4096" min="1" max="65536">
        <span style="font-size: 0.78rem; color: var(--fg-muted);">(affects FLOPs, not grid size)</span>
      </div>

      <div class="calc-divider"></div>

      <div style="font-size: 0.88rem; font-weight: 600; margin-bottom: 12px;">Tiling / Block Configuration</div>

      <div class="calc-row">
        <div class="calc-label">Tile size M (BLOCK_M):</div>
        <input type="number" class="calc-input" id="calcTileM" value="4" min="1" max="256">
        <span style="font-size: 0.78rem; color: var(--fg-muted);">rows of C per block</span>
      </div>
      <div class="calc-row">
        <div class="calc-label">Tile size N (BLOCK_N):</div>
        <input type="number" class="calc-input" id="calcTileN" value="128" min="1" max="256">
        <span style="font-size: 0.78rem; color: var(--fg-muted);">cols of C per block</span>
      </div>
      <div class="calc-row">
        <div class="calc-label">Threads per block:</div>
        <input type="number" class="calc-input" id="calcThreads" value="128" min="32" max="1024" step="32">
      </div>

      <div class="calc-divider"></div>

      <!-- Results -->
      <div class="grid-2" style="gap: 16px;">
        <div>
          <div style="font-size: 0.88rem; font-weight: 600; margin-bottom: 12px;">Computed Values</div>
          <div class="equation-box" style="text-align: left;">
            <span class="eq-label">Grid dimensions</span>
            grid = [<span id="rGridX" class="eq-highlight">16</span>, <span id="rGridY" class="eq-highlight">32</span>, 1]
          </div>
          <div class="equation-box" style="text-align: left;">
            <span class="eq-label">Total blocks launched</span>
            <span id="rTotalBlocks" class="eq-highlight">512</span>
          </div>
          <div class="equation-box" style="text-align: left;">
            <span class="eq-label">Warps per block</span>
            <span id="rWarpsPerBlock" class="eq-highlight">4</span>
          </div>
          <div class="equation-box" style="text-align: left;">
            <span class="eq-label">Total FLOPs</span>
            <span id="rFlops" class="eq-highlight">2.15 B</span>
          </div>
        </div>
        <div>
          <div class="calc-big-result" style="margin-top: 0;">
            <div style="font-size: 0.78rem; color: var(--fg-muted); margin-bottom: 8px;">SM EFFICIENCY</div>
            <div class="calc-big-number" id="rSmEff">100%</div>
            <div class="calc-big-label" id="rSmEffDesc">All 108 SMs are active</div>
          </div>
          <div class="calc-big-result" style="margin-top: 12px; border-color: rgba(255,202,40,0.2); background: rgba(255,202,40,0.04);">
            <div style="font-size: 0.78rem; color: var(--fg-muted); margin-bottom: 8px;">BLOCKS PER SM</div>
            <div class="calc-big-number" id="rBlocksPerSM" style="font-size: 2.2rem;">4.74</div>
            <div class="calc-big-label" id="rBlocksPerSMDesc">Enough to hide some latency</div>
          </div>
        </div>
      </div>

      <!-- SM Efficiency bar for calculator -->
      <div class="eff-bar-container" style="margin-top: 20px;">
        <div class="eff-bar-track">
          <div class="eff-bar-fill good" id="calcEffBar" style="width: 100%;">100%</div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ============ SECTION 8: PROFILER READING GUIDE ============ -->
<section class="section section-dark" id="profiler">
  <div class="container">
    <div class="section-heading">
      <div class="section-label">Step 8 &mdash; Reading the Profiler</div>
      <h2><span class="gradient-text">TensorBoard Profiler: What All the Numbers Mean</span></h2>
      <p class="section-subtitle">Here's a field-by-field guide to what you see in TensorBoard's CUDA kernel details.</p>
    </div>

    <div class="fade-in" style="max-width: 900px; margin: 0 auto;">
      <!-- Profiler fields explained -->
      <div class="card" style="overflow-x: auto;">
        <h3>Kernel Details Panel</h3>
        <table class="prof-table" style="margin-top: 16px;">
          <thead>
            <tr>
              <th style="width: 180px;">Field</th>
              <th style="width: 120px;">Value</th>
              <th>What It Means</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="color: var(--fg);">stream</td>
              <td>7</td>
              <td>CUDA stream this kernel ran on. Different streams can overlap.</td>
            </tr>
            <tr>
              <td style="color: var(--fg);">correlation</td>
              <td>40</td>
              <td>Links this GPU kernel to the CPU-side launch event.</td>
            </tr>
            <tr>
              <td style="color: var(--fg);">registers per thread</td>
              <td class="val-neutral">122</td>
              <td>Each thread uses 122 of the 256 available registers. High register usage limits occupancy.</td>
            </tr>
            <tr>
              <td style="color: var(--fg);">shared memory</td>
              <td>12544</td>
              <td>12.5 KB of shared memory per block. Used for fast data sharing between threads in a block.</td>
            </tr>
            <tr>
              <td style="color: var(--fg);">blocks per SM</td>
              <td class="val-good">4.740741</td>
              <td>Average number of concurrent blocks per SM. Higher = better latency hiding.</td>
            </tr>
            <tr>
              <td style="color: var(--fg);">warps per SM</td>
              <td>18.962963</td>
              <td>~19 out of 64 max warps active. This drives occupancy = 19/64 &asymp; 25%.</td>
            </tr>
            <tr>
              <td style="color: var(--fg); font-weight: 600;">grid</td>
              <td class="val-good">[16, 32, 1]</td>
              <td><strong>Grid dimensions</strong> &mdash; how blocks are organized. Total = 16&times;32&times;1 = 512 blocks.</td>
            </tr>
            <tr>
              <td style="color: var(--fg); font-weight: 600;">block</td>
              <td class="val-good">[128, 1, 1]</td>
              <td><strong>Block dimensions</strong> &mdash; 128 threads per block (4 warps).</td>
            </tr>
            <tr>
              <td style="color: var(--fg); font-weight: 600;">est. achieved occupancy %</td>
              <td class="val-neutral">25</td>
              <td><strong>25% occupancy</strong> &mdash; 19 of 64 warp slots filled per SM. Limited by register usage.</td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Counter Sample -->
      <div class="card fade-in" style="margin-top: 24px;">
        <h3>Counter Sample Panel</h3>
        <p>Separately, TensorBoard shows the GPU performance counters:</p>
        <table class="prof-table" style="margin-top: 16px;">
          <thead>
            <tr>
              <th>Counter</th>
              <th>Series</th>
              <th>Value</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td style="color: var(--fg);">GPU 0 Est. SM Efficiency</td>
              <td>Est. SM Efficiency</td>
              <td class="val-good">1 (= 100%)</td>
            </tr>
          </tbody>
        </table>
        <p style="margin-top: 12px;">This confirms our calculation: min(512/108, 1) = <strong>1</strong>. All SMs are active during this kernel.</p>
      </div>

      <!-- The big picture -->
      <div class="card fade-in" style="margin-top: 24px;">
        <h3>The Complete Picture</h3>
        <div style="display: flex; gap: 20px; flex-wrap: wrap; margin-top: 16px;">
          <div style="flex: 1; min-width: 200px; text-align: center; padding: 16px; background: rgba(0,212,106,0.04); border-radius: 12px; border: 1px solid rgba(0,212,106,0.15);">
            <div style="font-size: 2.5rem; font-weight: 700; font-family: var(--font-mono); color: var(--primary);">100%</div>
            <div style="font-size: 0.82rem; color: var(--fg-muted);">SM Efficiency</div>
            <div style="font-size: 0.72rem; color: var(--fg-muted); margin-top: 4px;">All 108 SMs active</div>
          </div>
          <div style="flex: 1; min-width: 200px; text-align: center; padding: 16px; background: rgba(255,202,40,0.04); border-radius: 12px; border: 1px solid rgba(255,202,40,0.15);">
            <div style="font-size: 2.5rem; font-weight: 700; font-family: var(--font-mono); color: var(--yellow);">25%</div>
            <div style="font-size: 0.82rem; color: var(--fg-muted);">Achieved Occupancy</div>
            <div style="font-size: 0.72rem; color: var(--fg-muted); margin-top: 4px;">~19 of 64 warps per SM</div>
          </div>
          <div style="flex: 1; min-width: 200px; text-align: center; padding: 16px; background: rgba(66,165,245,0.04); border-radius: 12px; border: 1px solid rgba(66,165,245,0.15);">
            <div style="font-size: 2.5rem; font-weight: 700; font-family: var(--font-mono); color: var(--blue);">512</div>
            <div style="font-size: 0.82rem; color: var(--fg-muted);">Total Blocks</div>
            <div style="font-size: 0.72rem; color: var(--fg-muted); margin-top: 4px;">~4.74 per SM</div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- ============ SECTION 9: TAKEAWAYS ============ -->
<section class="section" id="takeaways">
  <div class="container">
    <div class="section-heading">
      <div class="section-label">Key Takeaways</div>
      <h2><span class="gradient-text">What You Should Remember</span></h2>
    </div>

    <div class="grid-3 fade-in">
      <div class="takeaway-card">
        <div class="takeaway-num">01</div>
        <h4>SM Efficiency = Are All SMs Busy?</h4>
        <p>min(blocks_launched / num_SMs, 1). Launch at least as many blocks as SMs to hit 100%. With 512 blocks on 108 SMs, all SMs are active.</p>
      </div>
      <div class="takeaway-card">
        <div class="takeaway-num">02</div>
        <h4>Occupancy = How Full is Each SM?</h4>
        <p>active_warps / max_warps per SM. Limited by registers, shared memory, and block count. 25% occupancy can still be performant for compute-bound kernels.</p>
      </div>
      <div class="takeaway-card">
        <div class="takeaway-num">03</div>
        <h4>Grid &amp; Block Dimensions Matter</h4>
        <p>Grid [16,32,1] = 512 blocks. Block [128,1,1] = 128 threads. These are chosen by CUDA libraries (cuBLAS) or set by you in custom kernels. They determine both SM efficiency and occupancy.</p>
      </div>
    </div>

    <div class="grid-3 fade-in" style="margin-top: 20px;">
      <div class="takeaway-card">
        <div class="takeaway-num">04</div>
        <h4>Small Matrices = Low Efficiency</h4>
        <p>If your matmul only generates 50 blocks on a 108-SM GPU, 58 SMs sit idle (54% efficiency). Batch size directly affects this &mdash; bigger batches = more blocks = more SMs used.</p>
      </div>
      <div class="takeaway-card">
        <div class="takeaway-num">05</div>
        <h4>Warps are the Real Unit</h4>
        <p>The GPU doesn't schedule individual threads &mdash; it schedules warps of 32 threads in SIMT lockstep. The warp scheduler on each SM juggles active warps to hide memory latency.</p>
      </div>
      <div class="takeaway-card">
        <div class="takeaway-num">06</div>
        <h4>Check TensorBoard First</h4>
        <p>When a kernel is slow, check: (1) SM Efficiency &mdash; are all SMs active? (2) Occupancy &mdash; is each SM being utilized? (3) Memory bandwidth &mdash; is the kernel memory-bound?</p>
      </div>
    </div>
  </div>
</section>

<!-- FOOTER -->
<footer class="footer">
  <div class="container">
    <div class="footer-brand">Vizuara 5D Parallelism <span class="gradient-text">Visual Guide</span></div>
    <p>GPU Efficiency &amp; SM Utilization &mdash; From Matrix Multiply to TensorBoard</p>
    <p style="margin-top: 8px;">Built for the GPU Workshop by Vizuara</p>
  </div>
</footer>

<!-- ============ JAVASCRIPT ============ -->
<script>
// ---- Scroll-in animation ----
const obs = new IntersectionObserver((entries) => {
  entries.forEach(e => { if (e.isIntersecting) { e.target.classList.add('visible'); obs.unobserve(e.target); } });
}, { threshold: 0.1 });
document.querySelectorAll('.fade-in').forEach(el => obs.observe(el));

// ---- SM Grid (static hero) ----
(function() {
  const grid = document.getElementById('smGrid');
  if (!grid) return;
  for (let i = 0; i < 108; i++) {
    const sm = document.createElement('div');
    sm.className = 'sm-unit active';
    sm.innerHTML = `<div class="sm-unit-id">SM${i}</div><div class="sm-blocks-count">~5 blk</div>`;
    grid.appendChild(sm);
  }
})();

// ---- Occupancy grid ----
(function() {
  const grid = document.getElementById('occupancyGrid');
  if (!grid) return;
  const active = 19;
  for (let i = 0; i < 64; i++) {
    const slot = document.createElement('div');
    slot.style.cssText = `width:24px;height:24px;border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:0.5rem;font-family:var(--font-mono);font-weight:600;`;
    if (i < active) {
      slot.style.background = 'var(--primary)';
      slot.style.color = '#000';
      slot.textContent = 'W' + i;
    } else {
      slot.style.background = 'rgba(255,255,255,0.04)';
      slot.style.border = '1px solid var(--border)';
      slot.style.color = '#333';
    }
    grid.appendChild(slot);
  }
})();

// ---- Interactive SM Efficiency Simulator ----
(function() {
  const blockSlider = document.getElementById('blockSlider');
  const smSlider = document.getElementById('smSlider');
  const blockVal = document.getElementById('blockSliderVal');
  const smVal = document.getElementById('smSliderVal');
  const effValue = document.getElementById('effValue');
  const effBar = document.getElementById('effBar');
  const activeSMsEl = document.getElementById('activeSMs');
  const totalSMsEl = document.getElementById('totalSMs');
  const blocksPerSMEl = document.getElementById('blocksPerSM');
  const idleSMsEl = document.getElementById('idleSMs');
  const smGridInteractive = document.getElementById('smGridInteractive');

  if (!blockSlider) return;

  function update() {
    const blocks = parseInt(blockSlider.value);
    const sms = parseInt(smSlider.value);
    blockVal.textContent = blocks;
    smVal.textContent = sms;

    const eff = Math.min(blocks / sms, 1);
    const effPct = Math.round(eff * 100);
    const activeSMs = Math.min(blocks, sms);
    const bps = blocks / sms;

    effValue.textContent = effPct + '%';
    effBar.style.width = effPct + '%';
    effBar.textContent = effPct + '%';
    effBar.className = 'eff-bar-fill ' + (effPct >= 80 ? 'good' : effPct >= 50 ? 'medium' : 'bad');

    activeSMsEl.textContent = activeSMs;
    totalSMsEl.textContent = sms;
    blocksPerSMEl.textContent = bps.toFixed(2);
    idleSMsEl.textContent = Math.max(0, sms - blocks);

    // Update SM grid
    smGridInteractive.innerHTML = '';
    for (let i = 0; i < sms; i++) {
      const sm = document.createElement('div');
      sm.className = 'sm-unit';
      if (i < blocks) {
        const myBlocks = Math.min(Math.ceil(blocks / sms), 32);
        if (blocks >= sms) {
          sm.className = 'sm-unit active';
          sm.innerHTML = `<div class="sm-unit-id">SM${i}</div><div class="sm-blocks-count">${Math.floor(bps)}-${Math.ceil(bps)} blk</div>`;
        } else {
          sm.className = 'sm-unit active';
          sm.innerHTML = `<div class="sm-unit-id">SM${i}</div><div class="sm-blocks-count">1 blk</div>`;
        }
      } else {
        sm.className = 'sm-unit idle';
        sm.innerHTML = `<div class="sm-unit-id">SM${i}</div><div class="sm-blocks-count">idle</div>`;
      }
      smGridInteractive.appendChild(sm);
    }
  }

  blockSlider.addEventListener('input', update);
  smSlider.addEventListener('input', update);
  update();
})();

// ---- GPU Preset Buttons ----
(function() {
  const presets = document.querySelectorAll('.gpu-preset');
  const smSlider = document.getElementById('smSlider');

  presets.forEach(btn => {
    btn.addEventListener('click', () => {
      presets.forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      const sms = parseInt(btn.dataset.sms);
      smSlider.value = sms;
      smSlider.dispatchEvent(new Event('input'));
    });
  });
})();

// ---- Calculator ----
(function() {
  const ids = ['calcM', 'calcN', 'calcK', 'calcTileM', 'calcTileN', 'calcThreads'];
  const inputs = {};
  ids.forEach(id => { inputs[id] = document.getElementById(id); });

  function calcUpdate() {
    const M = parseInt(inputs.calcM.value) || 1;
    const N = parseInt(inputs.calcN.value) || 1;
    const K = parseInt(inputs.calcK.value) || 1;
    const tileM = parseInt(inputs.calcTileM.value) || 1;
    const tileN = parseInt(inputs.calcTileN.value) || 1;
    const threads = parseInt(inputs.calcThreads.value) || 128;

    const gridX = Math.ceil(M / tileM);
    const gridY = Math.ceil(N / tileN);
    const totalBlocks = gridX * gridY;
    const warpsPerBlock = Math.ceil(threads / 32);
    const flops = 2 * M * N * K;

    // Get current SM count from the active GPU preset
    const activePreset = document.querySelector('.gpu-preset.active');
    const sms = activePreset ? parseInt(activePreset.dataset.sms) : 108;

    const smEff = Math.min(totalBlocks / sms, 1);
    const smEffPct = Math.round(smEff * 100);
    const bps = totalBlocks / sms;

    document.getElementById('rGridX').textContent = gridX;
    document.getElementById('rGridY').textContent = gridY;
    document.getElementById('rTotalBlocks').textContent = totalBlocks.toLocaleString();
    document.getElementById('rWarpsPerBlock').textContent = warpsPerBlock;

    // Format FLOPs
    let flopsStr;
    if (flops >= 1e12) flopsStr = (flops / 1e12).toFixed(2) + ' T';
    else if (flops >= 1e9) flopsStr = (flops / 1e9).toFixed(2) + ' B';
    else if (flops >= 1e6) flopsStr = (flops / 1e6).toFixed(2) + ' M';
    else flopsStr = flops.toLocaleString();
    document.getElementById('rFlops').textContent = flopsStr;

    document.getElementById('rSmEff').textContent = smEffPct + '%';
    document.getElementById('rSmEffDesc').textContent = smEffPct === 100
      ? `All ${sms} SMs are active`
      : `${Math.min(totalBlocks, sms)} of ${sms} SMs active (${sms - Math.min(totalBlocks, sms)} idle)`;

    document.getElementById('rBlocksPerSM').textContent = bps.toFixed(2);
    document.getElementById('rBlocksPerSMDesc').textContent = bps >= 2
      ? 'Enough to hide some latency'
      : bps >= 1 ? 'Minimal latency hiding' : 'Not all SMs are covered!';

    const bar = document.getElementById('calcEffBar');
    bar.style.width = smEffPct + '%';
    bar.textContent = smEffPct + '%';
    bar.className = 'eff-bar-fill ' + (smEffPct >= 80 ? 'good' : smEffPct >= 50 ? 'medium' : 'bad');
  }

  ids.forEach(id => { inputs[id].addEventListener('input', calcUpdate); });
  document.querySelectorAll('.gpu-preset').forEach(btn => {
    btn.addEventListener('click', () => setTimeout(calcUpdate, 10));
  });
  calcUpdate();
})();

// ---- Smooth scroll for nav links ----
document.querySelectorAll('.nav-links a').forEach(a => {
  a.addEventListener('click', e => {
    const href = a.getAttribute('href');
    if (href.startsWith('#')) {
      e.preventDefault();
      const target = document.querySelector(href);
      if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }
  });
});
</script>

</body>
</html>
